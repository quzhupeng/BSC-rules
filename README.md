# 平衡计分卡KPI数据处理脚本

## 功能说明

本脚本用于将非结构化的KPI考核指标数据转化为标准化的平衡计分卡格式。

### 主要功能

1. **自动识别列**：自动识别目标值列和计分规则列
2. **数据清洗**：统一处理百分比格式（85% → 0.85，保留原始格式标记）
3. **底线值推导**：
   - 逻辑A：显式阈值提取（"低于85%不得分"）
   - 逻辑B：扣分规则计算（"每低1%扣2分"）
   - 逻辑C：默认兜底（目标值的80%/120%）
4. **指标方向判定**：自动识别正向/逆向指标
5. **规范文案生成**：按标准模板生成计分规则

### 依赖库

```bash
pip install pandas openpyxl
```

## 使用方法

### 方式一：命令行运行

```bash
python bsc_processor.py 你的文件.xlsx
```

如果不指定文件，脚本会自动使用当前目录下的第一个Excel文件。

### 方式二：作为模块导入

```python
from bsc_processor import BSCProcessor

# 创建处理器
processor = BSCProcessor('input.xlsx')

# 执行处理
processor.process()

# 保存结果
processor.save('output.xlsx')
```

## 输入文件格式要求

Excel文件需包含以下列（列名可变）：
- **目标值列**：列名需包含"目标值"关键字
- **计分规则列**：列名需包含"计分规则"关键字

示例：
| 指标名称 | 年度目标值 | 计分规则 |
|---------|-----------|---------|
| 收入完成率 | 90% | 完成率低于85%不得分 |
| 利润额 | 500 | 每低10万扣5分 |

## 输出说明

脚本会生成 `processed_scorecard.xlsx`，包含新增列：

| 新增列 | 说明 |
|-------|------|
| 推导底线值 | 计算出的底线值（保留原始格式） |
| 规范版计分规则 | 标准化的计分规则文案 |
| 解析状态 | Success（成功）/ Manual Check（需人工核对） |
| 指标方向 | positive（正向）/ negative（逆向） |

## 规则解析逻辑

### 逻辑A：显式阈值

优先从规则文本中提取显式声明的底线值：
- `低于85%不得分` → 底线值 = 85%
- `60分得60分` → 底线值 = 60

### 逻辑B：扣分推导

根据扣分规则计算允许偏差：
```
允许偏差 = (40 / 扣分) × 单位
底线值 = 目标值 ± 允许偏差
```

### 逻辑C：默认兜底

- 正向指标：底线值 = 目标值 × 80%
- 逆向指标：底线值 = 目标值 × 120%
- 标记为 `Manual Check`，需人工核对

## 规范文案模板

### 正向指标（越高越好）
```
P为指标实际值，XX为目标值，YY为底线值。
1.若P≥XX，得100分（满分）；
2.若YY<P<XX，按线性比例计算，即：得分=60+(P-YY)/(XX-YY)×(100-60)；
3.若P=YY，得60分（基础分）；
4.若P<YY，得0分。
```

### 逆向指标（越低越好）
```
P为指标实际值，XX为目标值，YY为底线值。
1.若P≤XX，得100分（满分）；
2.若XX<P<YY，按线性比例计算，即：得分=100-(P-XX)/(YY-XX)×(100-60)；
3.若P=YY，得60分（基础分）；
4.若P＞YY，得0分。
```

## 注意事项

1. **百分比处理**：脚本会自动识别并保留原始百分比格式
2. **异常处理**：单行数据错误不会中断整个处理流程
3. **人工核对**：解析状态为 `Manual Check` 的行需要人工复核
4. **列宽设置**：输出Excel已自动设置列宽和自动换行
